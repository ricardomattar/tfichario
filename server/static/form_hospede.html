<div class="container-fluid border">
    <div class="row">
        <div class="col-3 border">
            <div class="row border-bottom">
                <div>
                <table id="tbl_pesquisa" class="display table table-striped"
                            style="height:600px;
                            width:100%;
                            overflow-y:scroll;
                            display:block;
                            ">
                  <thead>
                    <tr>
                      <th scope="col">Nome</th>
                      <th scope="col">CPF</th>
                      <th scope="col">RG</th>
                      <th scope="col" style="display:none;">ID</th>
                    </tr>
                  </thead>
                  <tbody>
                  <tr></tr>
                  </tbody>
                </table>
                </div>
            </div>
            <div class="row border-bottom">
                <div class="col-3">
                    <label for="pesquisar">Pesquisar</label>
                </div>
                <div class="col-9">
                    <input class="w-100" type="text" name="pesquisar" id="pesquisar" placeholder="Pesquisa"
                    onkeypress="pesquisar_keypress(event)"><br>
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="container-fluid" id="div_ficha">
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="uuid">UUID</label>
                    </div>
                    <div class="col-9">
                        <input  class="w-100" type="text" name="uuid" id="uuid" placeholder="UUID"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="data_cadastro">Cadastro</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="data_cadastro" id="data_cadastro" placeholder="Data do cadastro"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="nome">Nome</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="nome" id="nome" placeholder="Nome"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="mae">Mãe</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="mae" id="mae" placeholder="Nome da mae"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="cpf">CPF</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="cpf" id="cpf" placeholder="CPF"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="rg">RG</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="rg" id="rg" placeholder="RG"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="naturalidade">Naturalidade</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="naturalidade" id="naturalidade" placeholder="Naturalidade"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="nascimento">Nascimento</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="nascimento" id="nascimento" placeholder="Data de nascimento"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="nacionalidade">Nacionalidade</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="nacionalidade" id="nacionalidade" placeholder="Nacionalidade"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="profissao">Profissão</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="profissao" id="profissao" placeholder="Profissao"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="empresa">Empresa</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="empresa" id="empresa" placeholder="empresa"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="carroplaca">Placa carro</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="carroplaca" id="carroplaca" placeholder="Placa do carro"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="procedencia">Destino</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="procedencia" id="procedencia" placeholder="Procedencia"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="destino">Destino</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="destino" id="destino" placeholder="Destino"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="endereco">Endereço</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="endereco" id="endereco" placeholder="Endereco"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="bairro">Bairro</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="bairro" id="bairro" placeholder="Bairro"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="cidade">Cidade</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="cidade" id="cidade" placeholder="Cidade"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="estado">Estado</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="estado" id="estado" placeholder="Estado"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="cep">CEP</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="cep" id="cep" placeholder="CEP"><br>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="telefones">Telefones</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="telefones" id="telefones" placeholder="Telefones"><br>
                    </div>
                </div>
                <div class="row">
                    <div class="col-3">
                        <label for="email">E-Mail</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="email" id="email" placeholder="E-Mail"><br>
                    </div>
                </div>
            </div>
            </div>
        <div class="col-3">
            <div class="container-fluid">
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="extras">Notas:</label>
                    </div>
                    <div class="col-9">
                        <textarea class="form-control" id="extras" name="extras"
                         rows="10" cols="33" placeholder="Notas">
                        </textarea>
                    </div>
                </div>
                <div class="row border-bottom">
                    <div class="col-3">
                        <label for="extras">Usuario</label>
                    </div>
                    <div class="col-9">
                        <input class="w-100"  type="text" name="usuario" id="usuario" placeholder="Usuario"><br>
                    </div>
                </div>
                <div class="row align-items-end">
                    <div class="col-3">
                        <button id="btn_salvar" type="button" class="btn btn-primary" onclick="salvar_ficha()">Salvar</button>
                    </div>
                    <div class="col-3">
                        <button id="btn_novaficha" type="button" class="btn btn-primary" onclick="myevent()"
                        >Nova ficha</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    function salvar_ficha_callback(data, status) {
        console.log(data);
        console.log(status);
        if (status == 200) {
            mostrar_fichar($("#uuid.val()"));
        }
    }

    function salvar_ficha() {
        // params = {}
        // params['method'] = 'hospedes.rpc_save'
        // for key in self.fields.keys():
        // params[key] = self.fields[key].get().strip()
        //
        // params['usuario'] = glb.username
        //
        // if post.call(**params):
        // self.show_record(self.uuid.get())

        var params = {};
        params['method'] = 'hospedes.rpc_save';
        var inp = $("#div_ficha *").filter(':input');
        $.each(inp, function(i, item) {
            params[item.id] = item.value;
        });
        params['extras'] = $("#extras").val();
        params['usuario'] = glb_UserName;

        callserver(salvar_ficha_callback,
            glb_UserName, glb_Password, JSON.stringify(params));

    }

    function pesquisar_keypress(event) {
        //See notes about 'which' and 'key'
        if (event.which == 13 || event.keyCode == 13) {
            pesquisar_fichas();
        }
    }

    function mostrar_ficha_keypress(event) {
        if (event.which == 13 || event.keyCode == 13) {
            mostrar_ficha();
        }
    }

    function mostrar_ficha_click(event) {
        var uuid = $(event.target).parent().find("td:nth-child(4)").text();
        mostrar_ficha(uuid);
    }

    function pesquisar_fichas_callback(data, status) {
        var lista = JSON.parse(data);
        var tbl = '';
        $.each(lista, function(i, item) {
            tbl += '<tr id=row_' + i + ' onkeypress="mostrar_ficha_keypress(event)" onclick="mostrar_ficha_click(event)">'
            tbl += '<td>' + item['nome'] +
                '</td><td>' + item['cpf'] +
                '</td><td>' + item['rg'] +
                '</td><td style="display:none;">' + item['uuid'] +
                '</td></tr>';
        });

        $("#tbl_pesquisa tbody").html(tbl);

        // $('#tbl_pesquisa tbody').on( 'click', 'tr', function () {
        //     if ( $(this).hasClass('selected') ) {
        //         $(this).removeClass('selected');
        //     }
        //     else {
        //         tablehospedes.$('tr.selected').removeClass('selected');
        //         $(this).addClass('selected');
        //     }
        // } );
        //
        // $('#button').click( function () {
        //     tablehospedes.row('.selected').remove().draw( false );
        // } );
    }

    function pesquisar_fichas() {
        var params = {};
        params['method'] = 'hospedes.rpc_query';
        params['query'] = $("#pesquisar").val();

        callserver(pesquisar_fichas_callback,
           glb_UserName, glb_Password, JSON.stringify(params));
    }

    function mostrar_ficha_callback(data, status) {
        var ficha = JSON.parse(data);
        $.each(ficha, function(key, value) {
            $('#' + key).val(value);
        });


    }


    function mostrar_ficha(uuid) {
        var params = {};
        params['method'] = 'hospedes.rpc_get';
        params['uuid'] = uuid;

        callserver(mostrar_ficha_callback,
            glb_UserName, glb_Password, JSON.stringify(params));

    }
</script>
